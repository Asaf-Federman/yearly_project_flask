import cv2
import numpy as np

colors = {
    'bright_blue': [[[109, 70, 132], [149, 90, 212]], [[158, 28, 212], [178, 48, 242]],
                    [[127, 49, 154], [147, 69, 184]], [[142, 110, 110], [162, 130, 140]]],
    'blue': [[[115, 95, 64], [170, 135, 144]],
             [[144, 100, 43], [164, 120, 73]], [[120, 73, 56], [140, 93, 86]]],
    'gray': [[[-9, 78, 125], [11, 98, 165]], [[-10, 64, 89], [10, 84, 119]], [[151, 122, 68], [171, 142, 98]],
             [[160, 87, 129], [180, 107, 159]], [[-4, 48, 100], [16, 68, 130]],
             [[-4, 98, 72], [16, 118, 102]]],
    'red': [[[170, 100, 100], [180, 255, 255]],
            [[-8, 35, 167] , [12, 55, 207]], [[169, 43, 167] , [189, 63, 207]],
            [[166, 87, 143], [186, 107, 173]]],
    'bright_brown': [[[-33, 189, 24], [47, 249, 144]], [[-3, 99, 128], [17, 119, 158]],
            [[6, 165, 97], [26, 185, 127]], [[1, 210, 162], [21, 230, 192]],
                     [[0, 202, 155], [20, 222, 185]], [[165, 74, 61], [185, 94, 91]],
                     [[-10, 174, 135], [10, 194, 165]], [[-10, 187, 112], [10, 207, 142]],
                     [[-8, 184, 148], [12, 204, 178]], [[-8, 175, 153], [12, 195, 183]]],
    'brown': [[[-3, 88, 50], [17, 108, 80]], [[169, 68, 50], [189, 88, 80]],
              [[-4, 117, 61], [16, 137, 91]], [[0, 167, 67], [20, 187, 97]],
              [[168, 168, 28], [188, 188, 58]], [[-1, 237, 107], [19, 257, 137]],
              [[161, 192, 52], [181, 212, 82]], [[165, 203, 71], [185, 223, 101]]],
    'dark': [[[-29, 98, -44], [51, 158, 76]], [[1, 1, 0], [10, 10, 27]],
            [[-10, 80, 2], [10, 100, 32]], [[6, 113, 16], [26, 133, 46]],
            [[10, 33, 3], [30, 53, 33]], [[1, 83, 7], [21, 103, 37]],
             [[-8, 163, 38], [12, 183, 68]]]
}


def color_eval(image, mask):
    lesion_only = cv2.bitwise_and(image, image, mask=mask)
    colors_extraction = {color: color_mask_extraction(lesion_only, colors[color]) for color in colors.keys()}



def color_mask_extraction(image, color_borders):
    img_hsv = cv2.cvtColor(image, cv2.COLOR_BGR2HSV)
    color_mask = np.zeros(image.shape[:2], dtype=np.uint8)
    for color_border in color_borders:
        hsv_color1 = np.asarray(color_border[0])
        hsv_color2 = np.asarray(color_border[1])
        mask = cv2.inRange(img_hsv, hsv_color1, hsv_color2)
        color_mask = cv2.bitwise_or(color_mask, mask)
    return color_mask
